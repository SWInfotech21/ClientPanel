<!-- Wappler include head-page="layouts/main" fontawesome_5="cdn" bootstrap5="local" is="dmx-app" id="bbpsservices" appConnect="local" components="{dmxDatastore:{}}" -->
<meta name="ac:route" content="/bbps-services">
<link href="css/css-bbps.css" rel="stylesheet" />
<dmx-serverconnect id="scServiceBBPS" url="api/Services/BbpsServices"></dmx-serverconnect>
<dmx-datastore id="dsAppInfo" session="true"></dmx-datastore>
<dmx-value id="varTab" dmx-bind:value="'Services'"></dmx-value>

<div id="divAllTabs" class="row no-gutters pt-3 px-0 mx-0 align-items-end" dmx-hide="varTab.value == 'Paid'">
    <div class="col-lg-3 col-md-3 col-3" dmx-on:click="varTab.setValue('Services')">
        <!--dsAppInfo.clear()-->
        <a class="btn btn-block sw-tabs sw-tabs-first py-2" href="#" dmx-class:disabled="varTab.value != 'Services'" dmx-class:sw-tabs-active="varTab.value == 'Services'">Select Service</a>
    </div>
    <div class="col-lg-3 col-md-3 col-3" dmx-on:click="run({condition:{if:`dsApptInfo.data[0].locationId`,then:{steps:{run:{action:`varTab.setValue(\'Operator\')`}}}}})">
        <a class="btn btn-block sw-tabs sw-tabs-middle py-2" dmx-class:disabled="varTab.value != 'Operator'" href="#" dmx-class:sw-tabs-active="((varTab.value == 'Operator') || (varTab.value == 'Service'))">Select Operator</a>
    </div>
    <div class="col-lg-3 col-md-3 col-3" dmx-on:click="run({condition:{if:`dsApptInfo.data[0].ConsultationtypeId`,then:{steps:{run:{action:`varTab.setValue(\'CustomerInfo\')`}}}}})">
        <a class="btn btn-block sw-tabs sw-tabs-middle py-2" dmx-class:disabled="varTab.value != 'CustomerInfo'" href="#" dmx-class:sw-tabs-active="varTab.value == 'CustomerInfo'">Customer Info</a>
    </div>
    <div class="col-lg-3 col-md-3 col-3" dmx-on:click="">
        <a class="btn btn-block sw-tabs sw-tabs-last py-2" href="#" dmx-class:disabled="varTab.value != 'Payment'" dmx-class:sw-tabs-active="varTab.value == 'Payment'">Payment</a>
    </div>
</div>

<div id="crLocation" is="dmx-if" dmx-bind:condition="varTab.value == 'Services'">
    <div class="d-flex flex-column px-2 px-md-4 mt-2 mt-md-4 sw-content overflow-auto">
        <!-- <p class="align-items-center d-flex font-weight-bolder mb-2">Select Service (4)<span dmx-show="scLocSpecService.state.executing" class="spinner-border spinner-border-sm ml-2" role="status"></span></p> -->
        <div class="row m-0" is="dmx-repeat" id="repeatServices" dmx-bind:repeat="content.scServiceBBPS.data.All">
            <div class="col-md-3 col-sm-4 col-6 pb-3">
                <div class="sw-card-pay text-center" dmx-on:click="dsAppInfo.clear();varTab.setValue('Operator');dsAppInfo.insert({servicesName: service_name, servicesId: services_id, servicesIndex: $index})">
                    <img class="sw-img-location" dmx-bind:src="'https://portal.swpay.in'+content.scServiceBBPS.data.All[$index].service_type">
                    <div class="card-body px-0">
                        <p class="card-title text-primary mb-2 fs-2 sw-font-monospace">{{service_name}}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="crOperator" is="dmx-if" dmx-bind:condition="((varTab.value == 'Operator') || (varTab.value == 'Service'))">
    <div class="d-flex flex-column mx-2 mx-md-3 mt-2 mt-md-4 align-items-start sw-content overflow-auto">
        <button class="btn btn-sm btn-link mb-2" dmx-on:click="run({condition:{if:`varTab.value==\'Operator\'`,then:{steps:{run:{action:`varTab.setValue(\'Services\')`}}},else:{steps:{run:{action:`varTab.setValue(\'Operator\')`}}}}})">
            <i class="fas fa-chevron-left mr-2"></i>Back</button>
        <div class="d-flex flex-row align-items-center w-100 px-2 mb-2 sw-search">
            <i class="fas fa-search ml-2"></i>
            <input type="text" class="form-control bg-transparent border-0 sw-font-14" placeholder="Search Operator" style="height: 50px;" name="inputSearchOperator" id="inputSearchOperator" dmx-show="varTab.value == 'Operator'">

        </div>
        <div id="repeatOperators" class="d-flex justify-content-between flex-wrap flex-row align-content-start align-items-end w-100" is="dmx-repeat" dmx-bind:repeat="content.crOperator.inputSearchOperator.value ? content.scServiceBBPS.data.All[dsAppInfo.data[0].servicesIndex].op.where(`operator_name.lowercase()`, content.crOperator.inputSearchOperator.value.lowercase(), 'contains') : content.scServiceBBPS.data.All[dsAppInfo.data[0].servicesIndex].op" key="op_id" dmx-show="varTab.value == 'Operator'">
            <div class="col-12 col-md-6 my-2 px-2">
                <div class="sw-doc border d-flex sw-mouse-pointer w-100 align-items-center p-2" dmx-on:click="varTab.setValue('CustomerInfo');dsAppInfo.update({$id: 1},{op_id: op_id, Operator: operator_name, OperatorIndex: $index, OperatorPic: op_image});">
                    <img class="sw-avatar" dmx-bind:src="'https://portal.swpay.in'+op_image" height="72" width="72">
                    <div class="ml-3 d-flex flex-column justify-content-start">
                        <h5>{{operator_name}}</h5>
                        <p class="sw-doc-specialty sw-font-14 m-0">{{content.dsAppInfo.data[0].servicesName}}</p>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<div id="crCustomerInfo" is="dmx-if" dmx-bind:condition="varTab.value == 'CustomerInfo'">
    <div class="d-flex flex-column mx-2 mx-md-3 mt-2 mt-md-4 align-items-start sw-content overflow-auto">
        <button class="btn btn-sm btn-link float-left" dmx-on:click="varTab.setValue('Operator')"><i class="fas fa-chevron-left mr-2"></i>Back</button>

        <div class="d-flex justify-content-between flex-wrap mt-2 px-2 w-100">
            <div class="col-12 col-md-12 px-0">
                <div class="mb-3">
                    <div class="d-flex w-100 align-items-center p-3 sw-patient-card-header">
                        <img class="sw-avatar" dmx-bind:src="'https://portal.swpay.in/'+content.dsAppInfo.data[0].op_image" height="72" width="72">
                        <div class="d-flex flex-column justify-content-start pl-3">
                            <h5 class="mb-2 font-weight-bold">
                                {{content.dsAppInfo.data[0].Operator}}
                            </h5>
                            <p class="sw-font-14 mb-1">
                                {{content.dsAppInfo.data[0].servicesName}}
                            </p>
                        </div>
                    </div>
                    <div class="w-100 align-items-start border-bottom p-2 px-sm-5 py-sm-3 sw-patient-card-body flex-wrap">
                        <h5 class="font-weight-bold sw-label-color flex-column ">{{content.scServiceBBPS.data.All[dsAppInfo.data[0].servicesIndex].service_name}} Bill Payment </h5>
                        <div class="flex-column mt-3">
                            <form id="scfAddAppointment" is="dmx-serverconnect-form" action="api/AddAppt" dmx-populate="" method="post" dmx-on:success="varConfirmation.setValue(1);varTab.setValue('Booked');varAppointcreated.setValue(1)">
                                <input type="hidden" name="Specialist" dmx-bind:value="{{dsApptInfo.data[0].spec_id}}">
                                <input type="hidden" name="Location" dmx-bind:value="{{dsApptInfo.data[0].locationId}}">
                                <input type="hidden" name="Consultationtype" dmx-bind:value="{{dsApptInfo.data[0].serviceId}}">
                                <input type="hidden" id="Appointmentdate" name="Appointmentdate" dmx-bind:value="dsApptInfo.data[0].apptDate.addMinutes(-varTimeDiff.value).formatDate('yyyy-MM-dd')">
                                <input type="hidden" id="Appointmenttime" name="Appointmenttime" dmx-bind:value="dsApptInfo.data[0].startTime">
                                <input type="hidden" id="txtEndTime" name="EndTime" dmx-bind:value="dsApptInfo.data[0].startTime.addMinutes(dsApptInfo.data[0].duration).formatDate('HH:mm:ss')">
                                <input type="hidden" name="Timediff" dmx-bind:value="varTimeDiff.value">
                                <input type="hidden" name="Source" dmx-bind:value="browser1.referrer">

                                <div class="row mx-0">
                                    <div class="col-12 col-lg-6 pl-lg-0 pr-lg-2 px-0">
                                        <div class="form-group">
                                            <label class="sw-font-12 sw-font-weight-600">Customer Account Number *</label>
                                            <input type="text" class="form-control" name="Patientname" id="firstname" placeholder="Enter Customer Account Number" required>
                                        </div>
                                    </div>
                                    <div class="col-12 col-lg-6 pl-lg-2 pr-lg-0 px-0">
                                        <div class="form-group">
                                            <label class="sw-font-12 sw-font-weight-600">Mobile Number *</label>
                                            <input type="text" id="txtPhone" class="form-control" required="" name="Patientphonenumber" required="">
                                        </div>
                                    </div>

                                    <div class="d-flex justify-content-end w-100 my-3">
                                        <button class="btn sw-btn-secondary px-5" dmx-on:click="dsApptInfo.update({$id: 1},{patientIndex: $index})" dmx-bind:disabled="scfAddAppointment.state.executing" type="submit">Fetch Bill<span class="spinner-border spinner-border-sm ml-2" role="status" dmx-show="scfAddAppointment.state.executing"></span></button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-7 pr-md-0 pl-md-4 px-0 sw-PatientInfo">

            </div>
        </div>
    </div>
</div>